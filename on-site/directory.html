<style>
    #directory-layout {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-evenly;
        gap: 16px;
    }

    .dir-player {
        min-height: 150px;
        width: 25%;
        background-color: #232E3D; /* $dark-blue */
        padding: 24px;
        display: flex;
        flex-direction: column;
    }

    .dir-player-name {
        font-family: Rasputin, serif;
        font-weight: bold;
        text-align: center;
        text-transform: uppercase;
        padding: 16px;
    }

    .dir-chars {
        list-style-type: none;
        line-height: 1.5rem;
    }
</style>

<div id="directory-layout"></div>

<script>
    /* Absolutely ridiculous code to pull the list of active members, their respective players, and profile links
     * and throw it into a JS object for (allegedly) easy use.
     */
    fetch("https://astonish.jcink.net/index.php?act=Members&max_results=1000").then(response => response.text()).then(html => {
        /* Pulls info from member list page and puts it into "players" object (unsorted).
         * Note: I had to add the characters per player as an array so to access the information needed, see
         * the explanation with "playersSorted" below.
         */
        const parser = new DOMParser();
        const htmlDoc = parser.parseFromString(html, "text/html");
        const element = htmlDoc.querySelector(".memberlist-layout");
        const players = {};
        const allChars = element.querySelectorAll(".memberlist-display-strategos, .memberlist-display-thiarchos, .memberlist-display-krisigos, .memberlist-display-mnemntia, .memberlist-display-sophist");
        allChars.forEach(el => {
            const playerName = el.querySelector(".player-name").innerText.toLowerCase();
            const charName = el.querySelector(".char-name").innerText;
            const profLink = el.querySelector("a").getAttribute("href");
            if (players[playerName]) {
                players[playerName].push({[charName]: profLink});
            } else {
                players[playerName] = [{[charName]: profLink}];
            }
        })

        // sort by player names alphabetically
        const sortedKeys = Object.keys(players).sort();
        const playersSorted = {};
        sortedKeys.forEach(key => playersSorted[key] = players[key]);

        /* Since the characters are stored as an array, remember that you have to access them with their array index.
         * Could there have been a better way to do this? Probably. But I've been working on it for way too long and
         * I need to move on to something else.
         * Cheat sheet:
         * (player = name of player, character = name of character as a string, index = array index for player/character)
         * Player Name: Object.keys(playersSorted)[index]
         * Character Name: Object.keys(playersSorted.player[index])[0]
         * Profile Link: playersSorted.player[index]["character"]
         */

        // Now we build the HTML to display everything nicely
        for (const [player] of Object.entries(playersSorted)) {
            // Create our container & div for the player name
            const playerName = document.createElement("div");
            const playerDiv = document.createElement("div");

            // Add respective classes for styling
            playerName.classList.add("dir-player-name");
            playerDiv.classList.add("dir-player");

            playerName.innerHTML = player;
            playerDiv.append(playerName);

            // Create & insert each character with a link to their profile
            playersSorted[player].forEach(char => {
                const charName = Object.keys(char)[0]
                const profLink = char[charName]
                const link = document.createElement("a");
                link.innerHTML = charName;
                link.setAttribute("href", `${profLink}`);
                link.classList.add("dir-chars");
                playerDiv.appendChild(link);
            })

            // Put it all together and add it to the directory
            document.getElementById("directory-layout").appendChild(playerDiv);
        }
    }).catch(error => console.error("Error fetching the webpage:", error));
</script>